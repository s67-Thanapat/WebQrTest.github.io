<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>DB Admin ‚Ä¢ Supabase (Safe)</title>
  <style>
    :root{
      --bg:#f7f8fc; --fg:#0b1220; --muted:#6b7280; --card:#ffffff; --border:#e5e7eb;
      --accent:#2563eb; --accent-2:#1e40af; --danger:#dc2626; --board-h:#f1f5f9;
      --row-a:#ffffff; --row-b:#f9fafb; --glow:0 6px 18px rgba(2,6,23,.06);
      --focus:#93c5fd; --chip:#f8fafc;
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--fg);font:15px/1.6 ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Arial}
    .wrap{max-width:1200px;margin:24px auto;padding:16px}
    h1{margin:0 0 14px;font-size:22px}
    .info-bar,.bar{display:flex;gap:12px;align-items:center;background:var(--card);border:1px solid var(--border);border-radius:14px;padding:12px;box-shadow:var(--glow)}
    .chip{display:inline-flex;align-items:center;gap:8px;background:var(--chip);border:1px solid var(--border);padding:8px 12px;border-radius:999px;font-weight:700}
    .muted{color:var(--muted)}
    .clock{margin-left:auto;font-weight:800;letter-spacing:.5px}
    .spacer{flex:1}
    input[type="search"], select, textarea{
      padding:10px 12px;border-radius:10px;border:1px solid var(--border);background:#fff;color:var(--fg);outline:none;
      transition:border-color .15s, box-shadow .15s; min-width: 220px;
    }
    input[type="search"]:focus, select:focus, textarea:focus{border-color:var(--accent); box-shadow:0 0 0 3px var(--focus)}
    button{padding:10px 14px;border:none;border-radius:10px;cursor:pointer;font-weight:600;transition:transform .05s ease, box-shadow .15s ease, background-color .15s ease, color .15s ease}
    button:active{transform:translateY(1px)}
    .btn{background:var(--accent);color:#fff;box-shadow:0 2px 8px rgba(37,99,235,.18)}
    .btn:hover{background:var(--accent-2)}
    .btn-ghost{background:#fff;color:var(--fg);border:1px solid var(--border)}
    .btn-ghost:hover{box-shadow:0 2px 10px rgba(2,6,23,.08)}
    .btn-del{background:var(--danger);color:#fff}
    .board{margin-top:12px;border:1px solid var(--border);border-radius:12px;overflow:auto;box-shadow:var(--glow);background:var(--card)}
    table{width:100%;border-collapse:collapse;font-size:14px;table-layout:auto;min-width:800px}
    thead th{background:var(--board-h);text-transform:uppercase;letter-spacing:.35px;padding:10px;border-bottom:1px solid var(--border);color:#334155;font-weight:700;position:sticky;top:0;z-index:1}
    tbody td{padding:8px 10px;border-bottom:1px solid var(--border);color:#0f172a}
    tbody tr:nth-child(odd){background:var(--row-a)} tbody tr:nth-child(even){background:var(--row-b)}
    td[contenteditable="true"]{outline:none}
    td[contenteditable="true"]:focus{box-shadow: inset 0 0 0 2px var(--focus)}
    .mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace}
    .nowrap{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
    .foot{display:flex;justify-content:space-between;align-items:center;margin-top:8px}
    .notice{margin-top:6px;color:#b45309;font-size:13px}
    .row-select{width:16px;height:16px}
    .sql-box{width:100%; min-height:120px}
    @media (max-width:720px){ .wrap{padding:12px} .clock{margin-left:0} input[type="search"]{min-width:160px;flex:1} .bar{flex-wrap:wrap} table{font-size:13px} }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
  <div class="wrap">
    <h1>DB Admin ‚Ä¢ Supabase</h1>

    <!-- Summary -->
    <div class="info-bar">
      <div class="chip">üì¶ ‡∏ï‡∏≤‡∏£‡∏≤‡∏á: <span id="tableCount" class="mono">‚Äî</span></div>
      <div class="chip">üßë ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ: <span id="userEmail" class="mono">‚Äî</span></div>
      <div class="clock" id="clock">--:--:--</div>
    </div>

    <!-- Toolbar -->
    <div class="bar" style="margin-top:12px">
      <label class="muted">‡∏ï‡∏≤‡∏£‡∏≤‡∏á</label>
      <select id="tableSelect"></select>

      <button class="btn" id="btnRefresh">‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä</button>
      <button class="btn-ghost" id="btnAddRow">‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏ñ‡∏ß</button>
      <button class="btn-ghost" id="btnSaveEdits">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
      <button class="btn-del" id="btnDeleteRows">‡∏•‡∏ö‡πÅ‡∏ñ‡∏ß‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</button>

      <span class="spacer"></span>
      <input id="search" type="search" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ (‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå)" autocomplete="off" />
      <button class="btn-ghost" id="btnExport">‚¨áÔ∏è CSV</button>
      <button class="btn-del" id="btnLogout">üö™ Logout</button>
    </div>

    <!-- Structure / SQL -->
    <div class="bar" style="margin-top:12px">
      <details>
        <summary class="muted" style="cursor:pointer">üîê ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á (SQL ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•)</summary>
        <div style="margin-top:8px">
          <textarea id="sqlInput" class="sql-box" placeholder="‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á: CREATE TABLE public.demo(id uuid primary key default gen_random_uuid(), name text);"></textarea>
          <div style="display:flex; gap:8px; margin-top:8px">
            <button class="btn" id="btnRunSQL">‡∏£‡∏±‡∏ô SQL (Edge Function)</button>
            <div class="muted">* ‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Edge Function <span class="mono">admin-sql</span> + CORS ‡∏Å‡πà‡∏≠‡∏ô</div>
          </div>
          <pre id="sqlResult" style="margin-top:8px; background:#0b1220; color:#e5e7eb; padding:10px; border-radius:8px; max-height:240px; overflow:auto"></pre>
        </div>
      </details>
    </div>

    <!-- Data Table -->
    <div class="board">
      <table aria-label="‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•">
        <thead id="thead"></thead>
        <tbody id="tbody"><tr><td class="muted" style="padding:12px">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‚Ä¶</td></tr></tbody>
      </table>
    </div>

    <div class="foot">
      <div id="countLabel" class="muted">‚Äî</div>
      <div class="muted">‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î: <span id="lastUpdate">‚Äî</span></div>
    </div>
    <div id="notice" class="notice"></div>
  </div>

<script>
/* ---------- CONFIG ---------- */
const SUPABASE_URL = "https://yowjvmiosrclqstoeqat.supabase.co";
const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inlvd2p2bWlvc3JjbHFzdG9lcWF0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTgwMDc0OTksImV4cCI6MjA3MzU4MzQ5OX0.p71LqTM5gaJcpaAMMnWzLgsLNAka0nmR7BYntBiSYfU";
const EDGE_BASE = "https://<YOUR-PROJECT-REF>.functions.supabase.co"; // ‚Üê ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
const EDGE_FUNC = "admin-sql"; // ‡∏ä‡∏∑‡πà‡∏≠‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô
const ALLOW_SQL = true; // ‡∏ï‡∏±‡πâ‡∏á false ‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà deploy

const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
const tz='Asia/Bangkok';
const fmtTime = new Intl.DateTimeFormat('th-TH',{hour:'2-digit',minute:'2-digit',second:'2-digit',hour12:false,timeZone:tz});
const fmtFull = new Intl.DateTimeFormat('th-TH',{dateStyle:'medium', timeStyle:'medium', hour12:false, timeZone:tz});

/* ---------- ELEMENTS ---------- */
const tableSelect = document.getElementById('tableSelect');
const tableCount  = document.getElementById('tableCount');
const userEmail   = document.getElementById('userEmail');
const thead = document.getElementById('thead');
const tbody = document.getElementById('tbody');
const btnRefresh = document.getElementById('btnRefresh');
const btnAddRow  = document.getElementById('btnAddRow');
const btnSaveEdits = document.getElementById('btnSaveEdits');
const btnDeleteRows = document.getElementById('btnDeleteRows');
const btnExport  = document.getElementById('btnExport');
const btnLogout  = document.getElementById('btnLogout');
const search = document.getElementById('search');
const countLabel = document.getElementById('countLabel');
const lastUpdate = document.getElementById('lastUpdate');
const notice = document.getElementById('notice');
const clock = document.getElementById('clock');

const sqlInput = document.getElementById('sqlInput');
const btnRunSQL = document.getElementById('btnRunSQL');
const sqlResult = document.getElementById('sqlResult');

/* ---------- STATE ---------- */
let CURRENT_TABLE = null;
let COLUMNS = [];      // [{column_name, data_type, is_nullable, column_default}]
let PKCOLUMNS = [];    // ["id", ...]
let RAW_ROWS = [];     // raw from db
let EDIT_BUFFER = new Map(); // key: rowKey; val: {patch obj}

/* ---------- CLOCK ---------- */
setInterval(()=> clock.textContent = fmtTime.format(new Date()), 1000);

/* ---------- AUTH INFO ---------- */
(async()=>{
  const { data: { user } } = await supabase.auth.getUser();
  userEmail.textContent = user?.email ?? 'anonymous';
})();

/* ---------- LOAD TABLE LIST ---------- */
async function loadTables(){
  tableSelect.innerHTML = `<option value="">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‚Ä¶</option>`;
  try{
    const { data, error } = await supabase.rpc('list_public_tables');
    if(error) throw error;
    tableSelect.innerHTML = `<option value="" disabled selected>‚Äî ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏≤‡∏£‡∏≤‡∏á ‚Äî</option>` + 
      data.map(r=>`<option value="${r.table_name}">${r.table_name} (${r.row_count})</option>`).join('');
    tableCount.textContent = data.length;
  }catch(e){
    tableSelect.innerHTML = `<option value="" disabled selected>‡∏™‡∏£‡πâ‡∏≤‡∏á RPC list_public_tables ‡∏Å‡πà‡∏≠‡∏ô</option>`;
    tableCount.textContent = '‚Äî';
    notice.textContent = "‚ÑπÔ∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏™‡∏£‡πâ‡∏≤‡∏á RPC 'list_public_tables', 'list_columns', 'list_primary_key' ‡∏ï‡∏≤‡∏°‡∏Ñ‡∏π‡πà‡∏°‡∏∑‡∏≠‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô";
  }
}

/* ---------- LOAD STRUCTURE ---------- */
async function loadStructure(table){
  const [cols, pk] = await Promise.all([
    supabase.rpc('list_columns', { p_table: table }),
    supabase.rpc('list_primary_key', { p_table: table })
  ]);
  if(cols.error) throw cols.error;
  if(pk.error) throw pk.error;
  COLUMNS = cols.data || [];
  PKCOLUMNS = (pk.data || []).map(x=>x.column_name);
}

/* ---------- LOAD DATA ---------- */
async function loadData(){
  if(!CURRENT_TABLE) return;
  tbody.innerHTML = `<tr><td style="padding:12px" class="muted">‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‚Ä¶</td></tr>`;
  EDIT_BUFFER.clear();
  const { data, error } = await supabase.from(CURRENT_TABLE).select('*').limit(200).order(PKCOLUMNS[0] || COLUMNS[0]?.column_name, {ascending:false});
  if(error){
    tbody.innerHTML = `<tr><td style="padding:12px">‚ùå ${error.message}</td></tr>`;
    return;
  }
  RAW_ROWS = data || [];
  renderTable();
  lastUpdate.textContent = fmtFull.format(new Date());
}

/* ---------- RENDER TABLE ---------- */
function renderTable(){
  // head
  const headCols = ['','_rowKey', ...COLUMNS.map(c=>c.column_name)];
  thead.innerHTML = `<tr>${headCols.map((h,i)=> {
    if(i===0) return `<th style="width:36px"></th>`;
    if(i===1) return `<th class="mono" style="min-width:100px">PK</th>`;
    return `<th class="nowrap">${h}</th>`;
  }).join('')}</tr>`;

  // filter
  const q = (search.value || '').toLowerCase();
  const rows = RAW_ROWS.filter(obj=>{
    if(!q) return true;
    return Object.values(obj).some(v=> String(v??'').toLowerCase().includes(q));
  });

  // body
  if(rows.length===0){
    tbody.innerHTML = `<tr><td style="padding:12px" class="muted">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</td></tr>`;
  }else{
    tbody.innerHTML = rows.map(row=>{
      const rowKey = getRowKey(row); // string
      const tds = COLUMNS.map(col=>{
        const colName = col.column_name;
        const val = row[colName];
        const editable = !PKCOLUMNS.includes(colName); // ‡πÑ‡∏°‡πà‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç PK
        return `<td contenteditable="${editable}" data-col="${colName}" data-rowkey="${rowKey}">${escapeHTML(val)}</td>`;
      }).join('');
      return `<tr>
        <td><input type="checkbox" class="row-select" data-rowkey="${rowKey}"></td>
        <td class="mono">${rowKey}</td>
        ${tds}
      </tr>`;
    }).join('');
  }
  countLabel.textContent = `‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ${rows.length} ‡πÅ‡∏ñ‡∏ß (‡∏à‡∏≤‡∏Å ${RAW_ROWS.length})`;
}

/* ---------- UTIL ---------- */
function escapeHTML(v){
  if(v===null || v===undefined) return '';
  return String(v).replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;');
}

// ‡∏ó‡∏≥ rowKey ‡∏à‡∏≤‡∏Å‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏µ‡∏¢‡πå‡∏´‡∏•‡∏±‡∏Å (‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏´‡∏•‡∏≤‡∏¢‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå)
function getRowKey(row){
  if(PKCOLUMNS.length===0){
    // fallback: ‡πÉ‡∏ä‡πâ‡∏Ñ‡πà‡∏≤ hash ‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß (‡πÑ‡∏°‡πà‡∏Ñ‡∏ß‡∏£‡πÉ‡∏ô‡πÇ‡∏õ‡∏£‡∏î‡∏±‡∏Å‡∏ä‡∏±‡∏ô)
    return 'ROW-' + JSON.stringify(row).length + '-' + Object.values(row).join('|').length;
  }
  return PKCOLUMNS.map(pk=>`${pk}:${row[pk]}`).join('|');
}

function parseRowKey(rowKey){
  // "id:123|ver:2" -> {id:'123', ver:'2'}
  const obj = {};
  rowKey.split('|').forEach(pair=>{
    const [k,...rest] = pair.split(':');
    obj[k] = rest.join(':'); // ‡πÄ‡∏ú‡∏∑‡πà‡∏≠‡∏Ñ‡πà‡∏≤‡∏°‡∏µ ':'
  });
  return obj;
}

/* ---------- EVENTS: Edit Buffer ---------- */
tbody.addEventListener('input', (e)=>{
  const cell = e.target.closest('td[contenteditable]');
  if(!cell) return;
  const col = cell.dataset.col;
  const rowKey = cell.dataset.rowkey;
  const newVal = cell.textContent;
  const patch = EDIT_BUFFER.get(rowKey) || {};
  patch[col] = newVal;
  EDIT_BUFFER.set(rowKey, patch);
});

/* ---------- ACTIONS ---------- */
btnRefresh.onclick = async ()=>{
  if(!CURRENT_TABLE) return;
  await loadStructure(CURRENT_TABLE);
  await loadData();
};

btnAddRow.onclick = async ()=>{
  if(!CURRENT_TABLE) return;
  // ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏° object ‡∏à‡∏≤‡∏Å columns (‡∏¢‡∏Å‡πÄ‡∏ß‡πâ‡∏ô PK ‡∏ó‡∏µ‡πà‡∏°‡∏µ default)
  const template = {};
  for(const c of COLUMNS){
    if(PKCOLUMNS.includes(c.column_name) && /default/i.test(c.column_default||'')) continue;
    template[c.column_name] = null;
  }
  const raw = prompt("‡πÉ‡∏™‡πà JSON ‡∏Ç‡∏≠‡∏á‡πÅ‡∏ñ‡∏ß‡πÉ‡∏´‡∏°‡πà (‡∏Ñ‡πà‡∏≤‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏ = null):", JSON.stringify(template, null, 2));
  if(!raw) return;
  try{
    const obj = JSON.parse(raw);
    const { error } = await supabase.from(CURRENT_TABLE).insert(obj).select('*');
    if(error) throw error;
    await loadData();
  }catch(e){
    alert("‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ: " + (e?.message || e));
  }
};

btnSaveEdits.onclick = async ()=>{
  if(EDIT_BUFFER.size===0){ alert("‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç"); return; }
  for (const [rowKey, patch] of EDIT_BUFFER.entries()){
    try{
      let q = supabase.from(CURRENT_TABLE).update(patch);
      const keys = parseRowKey(rowKey);
      for(const pk of PKCOLUMNS){
        q = q.eq(pk, keys[pk]);
      }
      const { error } = await q.select('*');
      if(error) throw error;
    }catch(e){
      alert(`‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à (row ${rowKey}): ` + (e?.message || e));
      return;
    }
  }
  EDIT_BUFFER.clear();
  await loadData();
  alert("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡πâ‡∏ß");
};

btnDeleteRows.onclick = async ()=>{
  const checks = [...document.querySelectorAll('.row-select:checked')];
  if(checks.length===0){ alert("‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏ñ‡∏ß"); return; }
  if(!confirm(`‡∏•‡∏ö ${checks.length} ‡πÅ‡∏ñ‡∏ß?`)) return;
  for(const c of checks){
    const keys = parseRowKey(c.dataset.rowkey);
    let q = supabase.from(CURRENT_TABLE).delete();
    for(const pk of PKCOLUMNS){ q = q.eq(pk, keys[pk]); }
    const { error } = await q;
    if(error){ alert("‡∏•‡∏ö‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: "+error.message); return; }
  }
  await loadData();
};

btnExport.onclick = ()=>{
  if(!RAW_ROWS.length) return;
  const cols = COLUMNS.map(c=>c.column_name);
  const header = ["_rowKey", ...cols];
  const lines = [header.join(",")];
  for(const row of RAW_ROWS){
    const rk = getRowKey(row);
    const fields = [rk, ...cols.map(c=>{
      const v = row[c]; return `"${String(v??'').replaceAll('"','""')}"`;
    })];
    lines.push(fields.join(","));
  }
  const blob = new Blob([lines.join("\n")], {type:"text/csv;charset=utf-8"});
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href=url; a.download=`${CURRENT_TABLE}_${Date.now()}.csv`; a.click();
  URL.revokeObjectURL(url);
};

btnLogout.onclick = async ()=>{
  await supabase.auth.signOut();
  window.location.href = "login.html";
};

search.addEventListener('input', renderTable);

tableSelect.addEventListener('change', async ()=>{
  CURRENT_TABLE = tableSelect.value;
  notice.textContent = "";
  await loadStructure(CURRENT_TABLE);
  await loadData();
});

/* ---------- RUN SQL VIA EDGE FUNCTION ---------- */
if(btnRunSQL){
  btnRunSQL.onclick = async ()=>{
    if(!ALLOW_SQL){ alert("‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô Edge Function"); return; }
    const sql = sqlInput.value.trim();
    if(!sql) return;
    // TODO: ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏à‡∏£‡∏¥‡∏á ‡∏Ñ‡∏ß‡∏£‡πÄ‡∏ä‡πá‡∏Ñ‡∏à‡∏≤‡∏Å token -> is_admin
    const is_admin = true;
    try{
      const res = await fetch(`${EDGE_BASE}/${EDGE_FUNC}`,{
        method:'POST',
        headers:{'content-type':'application/json'},
        body: JSON.stringify({ sql, is_admin })
      });
      const j = await res.json();
      sqlResult.textContent = JSON.stringify(j,null,2);
    }catch(e){
      sqlResult.textContent = '‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ' + (e?.message || e);
    }
  };
}

/* ---------- INIT ---------- */
(async()=>{
  await loadTables();
})();
setInterval(()=>{ /* ‡∏ô‡∏≤‡∏¨‡∏¥‡∏Å‡∏≤ */ }, 1000);
</script>
</body>
</html>
